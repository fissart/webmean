<div Ngxheadroom   [options]="options" class="fixed-navbar">
    <app-navigation></app-navigation>
</div>

<div class="py-5 my-1"></div>

<ng-template #new let-modal>
    <div class="modal-header h3">
{{unitytitle}} - {{themetitle}}
    </div>
    <div class="modal-body">
        <ng-katex-html [html]="text"></ng-katex-html>
        <div *ngIf="textoimg && textoimg.split('.').pop()!=='pdf'">
          <img [src]="apiURL+'/'+ textoimg" class="m-auto w-100 img-fluid" (error)="onImgError($event)">
        </div>
        <div class="bg-light text-center border rounded">
    *        {{textoimg}}
        </div>
        <ngx-doc-viewer *ngIf="textoimg && textoimg.split('.').pop()=='doc'"
        [url]="apiURL+'/'+ textoimg"
        viewer="google"
        style="width:100%;height:100vh;"
        ></ngx-doc-viewer>

        <ngx-doc-viewer *ngIf="textoimg && textoimg.split('.').pop()=='docx' || textoimg.split('.').pop()=='pptx'|| textoimg.split('.').pop()=='ptx' || textoimg.split('.').pop()=='xlsx'|| textoimg.split('.').pop()=='xls'"
        [url]="apiURL+'/'+ textoimg"
        viewer="google"
        style="width:100%;height:100vh;"
        ></ngx-doc-viewer>

        <ngx-extended-pdf-viewer *ngIf="textoimg && textoimg && textoimg.split('.').pop()=='pdf'"
        [src]="apiURL+'/'+ textoimg"
        [height]="'800px'"
        [useBrowserLocale]="false"
        [textLayer]="true"
        [showHandToolButton]="false">
      </ngx-extended-pdf-viewer>
    </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-info" (click)="modal.close('Save click')">Ok</button>
    </div>
</ng-template>


<div class="container">

  <div>
    <!--<button (click)="generateExcel()"> Generate Excel</button>
    <button (click)="exportToExcel()" class="btn btn-light">Exportar a Excel</button>
  -->
    <table id="season-tble">
      <tr>
      <!--
          <td rowspan="3">1st col</td> <td colspan="5">2nd col</td>
      </tr>
      <tr>
          <td>2nd col</td><td>wwwwwwwwwwwwww</td>
      </tr>
      <tr>
          <td>2nd col</td><td>wwwwwwwww</td>
      </tr>
      <tr>
      -->
        <th>N</th>
        <th>Nombre</th>
        <ng-container *ngFor="let www of themes index as i">
          <th *ngFor="let ww_ of www['themes'] index as i">{{ww_.title.substring(0,3)}}...</th>
        </ng-container>
      </tr>
      <tr *ngFor="let www of photo index as i">
        <td>{{ i+1 }} </td>
        <td>{{ www.userw[0].name }}</td>
        <td>
          <input *ngIf="rol==1 || rol==2" type="text" class="form-control p-1"  [value]="i" (blur)="onBlurMethod($event, www._id,  rol)">
        </td>

        <ng-container *ngFor="let w of www['cursse'] index as i">
          <ng-container *ngFor="let ww of w['units'] index as i" class="text-info">
            <ng-container *ngFor="let wwwww of ww['themes'] index as i" class="text-success">
              <td *ngFor="let ww_ of wwwww['task'] index as i">{{ww_.note}}</td>
            <!--
          -->
        </ng-container>
        </ng-container>
        </ng-container>
      </tr>
    </table>
  </div>

    <div class="row d-flex justify-content-center">
        <div [ngClass]="[www.userw[0]._id==user ? 'cardnew_ col-md-3 m-3 p-1':'cardnew col-md-3 m-3 p-1']" *ngFor="let www of photo index as i">
          <div class="text-center text-light">
           {{i+1}}. {{www.userw[0].name}}
             </div>
             <div class="text-center text-info">
              DNI{{www.userw[0].email.substring(8,20)}}
                </div>
            <button class="btn shadow-none p-0 my-1" (click)="open1($any(www).userw[0]._id)">
                <img [src]="apiURL+'/'+www.userw[0].foto" class="img-card-top imgcurse" (error)="onImgError($event)">

            </button>




                        <div  *ngFor="let w of www['cursse'] index as i">
                          <div *ngIf="w.units.length>0" class="text-center p-0 rounded transparencia">
                                <div class="row d-flex justify-content-center m-0 p-0">
                                  <div *ngFor="let ww of w['units'] index as i" [ngClass]="[ww.note ? ' col-md-6 col-lg-2 col-2 m-1 p-1':'col-md-6 p-1']">
                                    <span  class="h8 text-white d-none">{{i+1}}</span>
                                    <div class="row d-flex justify-content-center m-1 p-0">
                                      <div *ngFor="let wwwww of ww['themes'] index as i" [ngClass]="[wwwww.task.length ? 'col-md-5 rounded bg-info m-1 p-1':'col-md-5 rounded bg-light m-1 p-0']">
                                        <span  class="h9 d-none">{{i+1}}</span>
                                        <button *ngIf="rol==1 && !wwwww.task.length" class="btn btn-success p-0" (click)="savetask(wwwww._id, ww._id, w._id, www.userw[0]._id)">
&#3065;                                        </button>
                                        <div class="row">
                                          <div *ngFor="let ww_ of wwwww['task'] index as i">
                                              <span *ngIf="ww_.archivo" class="text-dark">&starf; {{ww_.archivo.split('.').pop()!}}</span>
                                              <button *ngIf="rol==1" class="btn btn-info m-0 p-0" (click)="deletetask($any(ww_)._id)"> x </button>
                                              {{ww_.note}}
                                              <button class="btn btn-info p-0" (click)="openwww(new, ww_.task, ww_.archivo, ww.title, wwwww.title)">
                                               &#x2766;
                                              </button>
                                              <input *ngIf="rol==1 || rol==2" type="text" class="form-control p-1"  [value]="ww_.note" (blur)="onBlurMethod($event, ww_._id, ww_.task)">
                                          </div>
                                        </div>

                                      </div>
                                    </div>
                                  </div>
                                </div>
                        </div>
                        </div>

            <button *ngIf="rol==1" class="btn btn-warning shadow-none mt-1" (click)="erraseinteger($any(www)._id)">
                Retirar del curso
            </button>
        </div>
    </div>

    <div *ngIf="datastd.length!==0 && rol==1" class="container py-1 px-0">
      <div class="justify-content-center align-items-center bg-ligth">
        <div *ngFor="let doc of datastd index as i">
          <div [ngClass]="[doc.www.length != 0 ? 'card bg-success text-light p-1 m-1':'card bg-light p-1 m-1']">
              <span class="">{{doc.name}}</span>
              <img [src]="apiURL + '/'+ doc.foto" (error)="onImgError($event)" class="border wrapperest5">
            <button *ngIf="doc.www.length == 0" class="btn btn-warning shadow-none rounded-0" (click)="integer(doc._id)">Integrar</button>
            <div *ngFor="let docwww of doc['www'] index as i">
            <button class="btn btn-info shadow-none mt-1" (click)="erraseinteger(docwww._id)">
                Retirar del curso
            </button>
          </div>
          </div>
        </div>
      </div>
    </div>
</div>
